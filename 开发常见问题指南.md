## IDEA

### 设置项目使用 IDEA 编译，而不是 gradle 编译，以提高编译速度

打开 `Preferences` -> `Build, Execution, Deployment` -> `Build Tools` -> `Gradle`。

将 `Building and run using` 和 `Run tests using` 两处都改为 `Intellij IDEA`



### 使 lombok 生效，启用 Annotation Processing

打开 `Preferences` ，搜索 `Annotation Processors` ，选择 `Enable Annotation Processing` 



### 设置空的类或接口定义后面的花括号放在一行

打开 `Preferences` -> `Editor` -> `Code Style -Java` -> `Wraping and Bracces` 。

将 `Simple classes in one line` 的 checkbox 勾选上。



### 创建代码作者，创建时间等信息的模板

打开 IDEA 的 `Preferences` -> `Editor` -> `File and live templates`，选择 `Includes` ，在 `File Header` 的右侧填写

```java
/**
 * @author https://github.com/gukt
 * @date  ${DATE} ${TIME}
 * @version 1.0
 */
```



### 阻止Unterminated statement警告

打开 `Pereference -> Editor -> Code Style -> Inspections`

搜索 `Unterminated statement` ，将对勾去掉。

![image-20200604143737459](/Users/ktgu/Pictures/typora/imagesimage-20200604143737459-4994703.png)





## Gradle

### 添加阿里云仓库

在 build.gradle 配置文中的 repositories 块中添加：

```groovy
repositories {
    maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' }
    mavenCentral()
}
```

搜索顺序为文件中定义的仓库顺序。



### 添加 task，为项目/模块创建默认代码结构

```groovy
task generateDefaultStructure {
  doLast {
    sourceSets*.java.srcDirs*.each { it.mkdirs() }
    sourceSets*.resources.srcDirs*.each { it.mkdirs() }
  }
}
```



### 设置 jar、war、bootJar 打包文件名称

假设 Project 指定了 `archivesBaseName` 以及 `version` 属性为：

```groovy
archivesBaseName 'foo'
version '0.1.0'
```

执行 `gradle jar` 后，会在 `build/libs` 目录中生成 `foo-0.1.0.jar` 。

如果 Project 没有指定 `archivesBaseName` ，则默认值为项目的根目录名；如果 `version` 没有指定，则打包后的文件名为 `foo.jar`

可以通过在 `jar` 块中指定 `archivesBaseName`：

```groovy
archivesBaseName = 'foo'

jar {
  		archivesBaseName = 'bar'
}
```

执行 `gradle jar` 后，生成 `bar.jar` 。注意：`jar` 中定义的 `archivesBaseName` 覆盖了 `project.archivesBaseName`。

也可以通过在 `jar` 块中指定 `archiveFileName` 来指定打包文件的全名：

```groovy
jar {
  		archiveFileName = "baz.jar"
}
```

执行 `gradle jar` 后，生成 `baz.jar` 。

`archiveFileName` 属性值可以使用变量：

```groovy
import java.text.SimpleDateFormat

archivesBaseName 'foo'
version '0.1.0'

jar {
			archiveFileName = "${archivesBaseName}-${project.version}" + '-' + new SimpleDateFormat("yyyy-MM-dd").format(new Date()) + '.jar'
}
```

执行 `gradle jar` 后，生成 `foo-0.1.0-2016-01-01.jar` 。

以上是以打包 `jar` 举例的，`war` 包和 `bootJar` 和 `jar` 同理。

注意：低版本中经常使用的 `baseName`、`archiveName` 在 `Gradle 5.x` 之后的版本中已弃用，使用 `archivesBaseName` 或 `archiveFileName` 代替。



### 打包可执行 jar

如果要打包一个可执行 `jar`，必须给 `MANIFEST` 设置 `Main-Class`属性，否则会提示没有主清单属性，该属性可以在 `jar` 块中设置：

```groovy
jar {
 		manifest {
        attributes(
                'Main-Class': 'tech.codedog.guides.Hello'
        )
    }
  	archiveFileName = 'hello.jar'
}
```

再次执行 `java -jar hello.jar` 就可以成功。

 

## Spring

### 启用 devtools

1. 打开 `build.gradle` 文件，在 `dependencies` 中添加依赖项：`compile("org.springframework.boot:spring-boot-devtools")`

2. 打开 `application.properties` ，设置两个开关

   ```properties
   spring.devtools.livereload.enabled=true
   spring.devtools.restart.enabled=true
   ```

3. 如果需要支持 `liverload` ，需下载并安装 `livereload` 插件，这样当app重启后，浏览器页面也会自动reload。

4. 打开 IDEA 的 `Preferences` -> `Build, Execution, Deployment` -> `Compiler` -> 将 `Build project automatically` 勾选上。

5. 在 IDEA 中输入快捷键 `shift+option+command+/` ，选择 `Registry...` ，勾选 `compiler.automake.allow.when.app.running`



### 依赖注入（TODO）

不建议在字段上进行注入，推荐使用构造器注入。如果要覆盖构造器注入，可以使用 setter 注入以覆盖构造器注入。

注意：当通过构造函数注入太多依赖时，会容易出错，而且往往意味着可能违背了`单一职责原则`，表明该类可能需要进行重构，将职责分离。



#### 常用注入注解

常用的用于依赖注入的注解有：

- @org.springframework.beans.factory.annotation.**Autowired** 

  按名称注入。

- @javax.annotation.**Resource**

  默认按类型注入，指定 name 属性时按名称注入。

- @Inject - JSR330，

- 另外还有用于在按名称注入时提供限定名称的注解@Qualifier（org.springframework.beans.factory.annotation），

@Autowired、@Inject默认按名称注入。@Autowired配合@指定依赖的名称，@Inject配合@Name指定依赖名称。

@Autowired、@Inject用法基本一样，只是@Autowired有一个required（默认true）属性，用于指定某些依赖可以为null。

#### 字段注入的弊端

1. 如果不使用Spring管理该对象，这些字段必须要通过反射注入，太麻烦了
2. 如果不是用Spring管理该对象，比如在自己创建对象实例时，很容易忘记或遗漏给这些字段赋值，会引起NullPointerException
3. 不能用final修饰这些字段。



